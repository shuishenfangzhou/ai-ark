这是一份经过精心整合的**终极提示词（Master Prompt）**。

你可以直接新建一个文件 `full_stack_upgrade.md`，把下面的内容全部复制进去，然后发给 Kiro (Trae)。这份提示词非常详细，涵盖了目录结构、后端逻辑、数据库模型、前端修改以及 Docker 编排。

------

# 🚀 全栈化重构指令：从静态网页到 Docker 微服务架构

**Kiro，你好！**

我现在有一个静态网站项目（AI工具导航站），目前结构是 `dist/index.html` + `dist/tools.json`。

我要将其升级为**前后端分离 + 数据库**的现代化架构，并使用 **Docker Compose** 进行一键部署。

请根据以下 5 个阶段的要求，帮我生成所有必要的代码和配置文件。

------

## 📂 目标项目结构

请基于这个结构生成代码：

Plaintext

```
AI-Ark/
├── docker-compose.yml       # 核心编排文件
├── init_db.py               # 数据迁移脚本（JSON -> MySQL）
├── backend/                 # 后端目录
│   ├── Dockerfile
│   ├── requirements.txt
│   ├── main.py              # FastAPI 主程序
│   ├── models.py            # 数据库模型
│   └── database.py          # 数据库连接
├── nginx/                   # Nginx 配置
│   └── default.conf
└── dist/                    # 前端静态资源 (现有的)
    ├── index.html
    ├── js/
    └── images/              # 图片文件夹
```

------

## 第一阶段：后端开发 (FastAPI + MySQL)

请在 `backend/` 目录下编写代码：

1. **技术栈**：Python 3.10, FastAPI, SQLAlchemy, PyMySQL。
2. **`models.py`**：定义 `Tool` 表：
   - `id`: Integer, Primary Key, Auto Increment
   - `name`: String (工具名称)
   - `description`: Text (简介)
   - `url`: String (官网链接)
   - `category`: String (分类)
   - `logo_path`: String (图片路径，如 `./images/xxx.png`)
   - `tags`: String (标签，逗号分隔)
3. **`main.py`**：
   - 创建 API：`GET /api/tools`。
   - **支持参数**：
     - `keyword` (可选): 模糊搜索 name 或 description。
     - `category` (可选): 精确筛选分类。
   - **CORS**：允许所有源 (`allow_origins=["*"]`)。
4. **`database.py`**：
   - 从环境变量 `DATABASE_URL` 读取连接字符串。

------

## 第二阶段：数据库迁移脚本 (JSON to DB)

我现有的数据在 `dist/tools.json` 里。请在根目录写一个 `init_db.py`：

1. 连接到 MySQL 数据库（使用 `sqlalchemy`）。
2. 读取 `dist/tools.json` 文件。
3. 检查数据库是否为空，如果为空，将 JSON 里的数据批量插入到 `Tool` 表中。
4. 这个脚本我会在 Docker 部署完成后手动运行一次。

------

## 第三阶段：前端重构 (API 对接)

请告诉我如何修改 `dist/index.html` 中的 JS 逻辑 (或提供修改后的 JS 代码片段)：

1. **废弃**：不再使用 `fetch('./tools.json')`。
2. **启用**：改为请求 `/api/tools`。
3. **搜索逻辑**：
   - 之前是前端 JS 过滤数组。
   - 现在改为：当用户输入停止 300ms 后 (Debounce)，向后端发送请求 `GET /api/tools?keyword=xxx`，重新渲染页面。
4. **分类逻辑**：
   - 点击侧边栏分类时，发送请求 `GET /api/tools?category=xxx`。

------

## 第四阶段：Nginx 配置 (反向代理)

请并在 `nginx/default.conf` 中编写配置：

1. 监听 80 端口。
2. **静态资源**：
   - `/` 路径：指向 `/usr/share/nginx/html` (即挂载的 dist 目录)。
   - `/images/`：确保能访问到图片。
3. **API 转发**：
   - 将所有 `/api/` 开头的请求，反向代理转发给后端容器 `http://backend:8000`。
   - 确保传递正确的 Host 头。

------

## 第五阶段：Docker Compose 编排

请并在根目录生成 `docker-compose.yml`：

1. **Service: db (MySQL 8.0)**
   - 设置 root 密码和数据库名 (`ai_ark_db`)。
   - 数据持久化挂载：`./mysql_data:/var/lib/mysql`。
   - 端口映射：`3306:3306`。
2. **Service: backend**
   - Build: `./backend`。
   - Command: `uvicorn main:app --host 0.0.0.0 --port 8000`.
   - Depends on: `db`.
   - Environment: `DATABASE_URL` 连接到 db 服务。
   - Volumes: 挂载 `./dist` 到 `/app/dist` (以便读取 tools.json)。
3. **Service: frontend (Nginx)**
   - Image: `nginx:alpine`.
   - Ports: `8080:80` (外部访问端口)。
   - Volumes:
     - `./dist` -> `/usr/share/nginx/html`
     - `./nginx/default.conf` -> `/etc/nginx/conf.d/default.conf`
   - Depends on: `backend`.

**请按顺序生成以上代码，每一步尽量详细。**

------

### 🛠️ 发送给 Kiro 后的操作指南 (你自己看)

当 Kiro 给你生成完代码后，你需要做以下操作：

1. **整理本地文件**：

   按照 Kiro 给出的“目标项目结构”，在你的 `D:\AI工具箱` 里新建 `backend`、`nginx` 文件夹，并把代码复制进去。

2. **上传服务器**：

   利用 SFTP 插件或 1Panel，把整理好的整个 `AI工具箱` 文件夹内容，上传到服务器 `/opt/1panel/apps/AIArk/dist` 的**上一级**（建议在服务器新建一个 `/opt/ai-ark-pro` 目录）。

3. **启动**：

   Bash

   ```
   cd /opt/ai-ark-pro
   docker-compose up -d --build
   ```

4. **初始化数据**：

   容器启动成功后，执行一次数据导入：

   Bash

   ```
   # 进入后端容器
   docker-compose exec backend python init_db.py
   ```

现在，把上面的 Markdown 内容发给 Kiro 吧！