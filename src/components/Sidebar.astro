---
// src/components/Sidebar.astro
interface Category {
  name: string;
  icon: string;
  color: string;
  count: number;
}

const categories: Category[] = [
  { name: "AI办公", icon: "fa-briefcase", color: "office", count: 197 },
  { name: "AI绘画", icon: "fa-palette", color: "image", count: 186 },
  { name: "AI写作", icon: "fa-pen-nib", color: "writing", count: 98 },
  { name: "AI视频", icon: "fa-video", color: "video", count: 98 },
  { name: "AI音频", icon: "fa-music", color: "audio", count: 88 },
  { name: "AI编程", icon: "fa-code", color: "code", count: 84 },
  { name: "AI对话", icon: "fa-comments", color: "chat", count: 79 },
  { name: "AI设计", icon: "fa-pen-ruler", color: "design", count: 72 },
  { name: "AI开发平台", icon: "fa-cube", color: "platform", count: 65 },
  { name: "AI模型", icon: "fa-brain", color: "model", count: 45 },
];

const categoryCount = categories.reduce((acc, cat) => acc + cat.count, 0);
---

<!-- Mobile Sidebar Overlay -->
<div id="mobile-sidebar-overlay" class="fixed inset-0 bg-black/50 z-40 lg:hidden hidden"></div>

<!-- Left Sidebar: Category Navigation -->
<aside id="sidebar-container" class="hidden lg:block w-56 flex-shrink-0 sticky top-16 h-[calc(100vh-4rem)] overflow-y-auto border-r border-slate-200 bg-white z-20 scrollbar-thin scrollbar-thumb-slate-300 scrollbar-track-transparent">
    <div class="p-3">
        <!-- All Categories Button -->
        <button id="all-categories-btn" class="w-full flex items-center px-3 py-2.5 text-sm font-medium text-slate-700 rounded-lg hover:bg-slate-50 transition mb-2 active bg-blue-50 text-blue-600">
            <div class="w-7 h-7 rounded-lg bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-white mr-2.5 flex-shrink-0">
                <i class="fa-solid fa-layer-group text-xs"></i>
            </div>
            <span class="flex-1 text-left truncate">全部分类</span>
            <span id="total-count-badge" class="text-xs text-slate-400 bg-slate-100 px-1.5 py-0.5 rounded flex-shrink-0 ml-1">{categoryCount}</span>
        </button>
        
        <!-- Category List -->
        <nav id="category-nav" class="space-y-0.5">
            {categories.map((cat) => (
                <button 
                    class="category-item w-full flex items-center px-3 py-2.5 text-sm font-medium text-slate-700 rounded-lg hover:bg-slate-50 transition"
                    data-category={cat.name}
                >
                    <div class={`w-7 h-7 rounded-lg bg-[var(--cat-color)]/10 flex items-center justify-center text-[var(--cat-color)] mr-2.5 cat-${cat.color} flex-shrink-0`}>
                        <i class={`fa-solid ${cat.icon} text-xs`}></i>
                    </div>
                    <span class="flex-1 text-left truncate">{cat.name}</span>
                    <span class="text-xs text-slate-400 bg-slate-100 px-1.5 py-0.5 rounded ml-1 flex-shrink-0">{cat.count}</span>
                </button>
            ))}
        </nav>
        
        <!-- Filters -->
        <div class="mt-4 pt-4 border-t border-slate-100">
            <h3 class="px-3 text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">筛选</h3>
            
            <!-- Pricing Filter -->
            <div class="px-3 mb-3">
                <label class="text-xs text-slate-500 mb-1.5 block">价格</label>
                <div class="space-y-1.5">
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" id="filter-free" class="filter-pricing w-3.5 h-3.5 text-blue-600 rounded border-slate-300 focus:ring-blue-500" value="free">
                        <span class="ml-2 text-xs text-slate-600">免费</span>
                    </label>
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" id="filter-paid" class="filter-pricing w-3.5 h-3.5 text-blue-600 rounded border-slate-300 focus:ring-blue-500" value="paid">
                        <span class="ml-2 text-xs text-slate-600">付费</span>
                    </label>
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" id="filter-opensource" class="filter-pricing w-3.5 h-3.5 text-blue-600 rounded border-slate-300 focus:ring-blue-500" value="opensource">
                        <span class="ml-2 text-xs text-slate-600">开源</span>
                    </label>
                </div>
            </div>
            
            <!-- Chinese Support Filter -->
            <div class="px-3">
                <label class="flex items-center cursor-pointer">
                    <input type="checkbox" id="filter-chinese" class="w-3.5 h-3.5 text-blue-600 rounded border-slate-300 focus:ring-blue-500">
                    <span class="ml-2 text-xs text-slate-600">中文支持</span>
                </label>
            </div>
        </div>
    </div>
</aside>

<script>
    // 分类点击事件
    document.querySelectorAll('.category-item').forEach((btn: Element) => {
        btn.addEventListener('click', function(this: HTMLElement) {
            const category = this.getAttribute('data-category');
            
            // 移除其他选中状态
            document.querySelectorAll('.category-item').forEach((b: Element) => {
                b.classList.remove('bg-blue-50', 'text-blue-600');
            });
            
            // 设置当前选中
            if (category) {
                this.classList.add('bg-blue-50', 'text-blue-600');
                
                // 过滤工具列表
                const event = new CustomEvent('categoryFilter', { detail: category });
                window.dispatchEvent(event);
            }
        });
    });

    // 全部分类
    document.getElementById('all-categories-btn')?.addEventListener('click', function(this: HTMLElement) {
        document.querySelectorAll('.category-item').forEach((b: Element) => {
            b.classList.remove('bg-blue-50', 'text-blue-600');
        });
        
        // 显示全部
        const event = new CustomEvent('categoryFilter', { detail: null });
        window.dispatchEvent(event);
    });
</script>
