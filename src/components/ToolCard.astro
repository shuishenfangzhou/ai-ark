---
// src/components/ToolCard.astro
interface Props {
  name: string;
  desc: string;
  category: string;
  tags: string[];
  logo?: string;
  url: string;
  rating?: number;
  color?: string;
  pricing?: string;
  popularity?: number;
  updated_at?: string;
}

const { name, desc, category, tags, logo, url, rating = 4.5, color = "chat", pricing = "free" } = Astro.props;

// Generate unique IDs
const compareId = `compare-${name.replace(/\s+/g, '-').toLowerCase()}`;
const favoriteId = `fav-${name.replace(/\s+/g, '-').toLowerCase()}`;

// Determine if Chinese tool
const isChinese = tags.some(t => t.includes('中文') || category.includes('中国') || name.match(/[\u4e00-\u9fa5]/) || ['文心一言', '智谱清言', '秘塔写作猫', '通义千问', '讯飞星火', 'Kimi', '天工AI', '百川智能', '零一万物', '腾讯混元', '商汤日日新'].includes(name));
---
<div class="tool-card bg-white rounded-xl border border-slate-200 p-4 hover:shadow-lg transition group relative"
     data-category={category}
     data-name={name.toLowerCase()}
     data-tags={tags.join(',').toLowerCase()}
     data-pricing={pricing}
     data-chinese={isChinese ? 'true' : 'false'}
     data-rating={rating}
     data-popularity={Astro.props.popularity || 0}
     data-updated={Astro.props.updated_at || new Date().toISOString()}>
    <div class="flex justify-between items-start mb-3">
        <!-- 点击图标/标题打开详情弹窗 -->
        <div class="cursor-pointer flex-1" onclick={`window.openToolDetail('${name}', '${desc}', '${url}')`}>
            <div class={`w-12 h-12 rounded-lg bg-${color}-50 flex items-center justify-center cat-${color}`}>
                <i class={`fa-solid fa-${color === 'chat' ? 'comments' : color === 'image' ? 'palette' : color === 'video' ? 'video' : color === 'code' ? 'code' : color === 'writing' ? 'pen-nib' : 'robot'} text-2xl text-[var(--cat-color)]`}></i>
            </div>
        </div>
        
        <div class="flex items-center gap-2">
            <!-- 修复后的对比复选框 -->
            <label class="w-6 h-6 border-2 border-slate-300 rounded flex items-center justify-center cursor-pointer hover:border-blue-500 transition bg-white" title="添加到对比">
                <input type="checkbox" class="peer hidden" data-tool-name={name}>
                <div class="w-3 h-3 bg-blue-500 rounded-sm scale-0 peer-checked:scale-100 transition-transform"></div>
            </label>
            
            <!-- 收藏按钮 -->
            <button class="w-6 h-6 flex items-center justify-center text-slate-400 hover:text-red-500 transition" id={favoriteId}>
                <i class="fa-regular fa-heart"></i>
            </button>
        </div>
    </div>
    
    <!-- 点击标题打开详情弹窗 -->
    <div class="cursor-pointer flex-1" onclick={`window.openToolDetail('${name}', '${desc}', '${url}')`}>
        <h3 class="font-bold text-slate-900 mb-1 group-hover:text-blue-600 transition">{name}</h3>
        <p class="text-xs text-slate-500 line-clamp-2 h-8">{desc}</p>
    </div>
    
    <div class="mt-3 flex flex-wrap gap-1.5">
        {tags.slice(0, 3).map((tag) => (
            <span class="px-2 py-0.5 bg-slate-100 text-slate-600 text-xs rounded-full">{tag}</span>
        ))}
    </div>
    
    <div class="mt-3 flex justify-between items-center border-t border-slate-50 pt-3">
        <div class="flex items-center">
            <div class="flex items-center text-amber-400 text-xs">
                {Array(5).fill(0).map((_, i) => (
                    <i class={`fa-solid fa-star ${i < Math.floor(rating) ? '' : 'fa-star-half-stroke'}`}></i>
                ))}
            </div>
            <span class="ml-1 text-xs text-slate-500">{rating}</span>
        </div>
        <a href={url} target="_blank" class="text-xs bg-blue-50 text-blue-600 px-3 py-1.5 rounded-full hover:bg-blue-100 transition font-medium">
            直达 <i class="fa-solid fa-arrow-right ml-1"></i>
        </a>
    </div>
</div>
