---
// src/components/ToolCard.astro
interface Props {
  name: string;
  desc: string;
  category: string;
  tags: string[];
  logo?: string;
  url: string;
  rating?: number;
  color?: string;
  pricing?: string;
  popularity?: number;
  updated_at?: string;
}

const { name, desc, category, tags, logo, url, rating = 4.5, color = "chat", pricing = "free" } = Astro.props;

// Known tool URLs
const KNOWN_TOOL_URLS: Record<string, string> = {
  'ChatGPT': 'https://chat.openai.com',
  'Claude': 'https://claude.com',
  '文心一言': 'https://yiyan.baidu.com',
  '通义千问': 'https://tongyi.aliyun.com',
  '智谱清言': 'https://chatglm.cn',
  '讯飞星火': 'https://xinghuo.xfyun.cn',
  'Kimi': 'https://kimi.ai',
  '天工AI': 'https://tiangong.cn',
  '百川智能': 'https://www.baichuan.com',
  '豆包': 'https://www.doubao.com',
  '蛙蛙写作': 'https://www.wawa.com',
  '笔灵AI小说': 'https://www.biling.cn',
  '稿定AI文案': 'https://www.gaoding.com',
  '光速写作': 'https://www.guangsuxiezuo.com',
  '秘塔写作猫': 'https://www.xiezuocat.com',
  'QuillBot': 'https://www.quillbot.com',
  'Notion AI': 'https://www.notion.so',
  'Midjourney': 'https://www.midjourney.com',
  'Stable Diffusion': 'https://stability.ai',
  'DALL-E': 'https://openai.com/dall-e-3',
  'Runway': 'https://runwayml.com',
  'Pika Labs': 'https://pika.art',
  '可灵 (Kling)': 'https://klingai.com',
  '即梦': 'https://jimeng.com',
  'GitHub Copilot': 'https://github.com/features/copilot',
  'Cursor': 'https://cursor.sh',
  'Perplexity AI': 'https://www.perplexity.ai',
  'Canva': 'https://www.canva.com',
  'Figma': 'https://www.figma.com',
  'LiblibAI': 'https://www.liblibai.com',
  'Gamma': 'https://gamma.app',
  'v0': 'https://v0.dev',
};

// Generate effective URL
const effectiveUrl = (url && url.startsWith('http')) ? url : (KNOWN_TOOL_URLS[name] || `https://www.ai-bot.cn/?s=${encodeURIComponent(name)}`);

// Generate unique IDs
const compareId = `compare-${name.replace(/\s+/g, '-').toLowerCase()}`;
const favoriteId = `fav-${name.replace(/\s+/g, '-').toLowerCase()}`;

// Determine if Chinese tool
const isChinese = tags.some(t => t.includes('中文') || category.includes('中国') || name.match(/[\u4e00-\u9fa5]/) || ['文心一言', '智谱清言', '秘塔写作猫', '通义千问', '讯飞星火', 'Kimi', '天工AI', '百川智能', '零一万物', '腾讯混元', '商汤日日新'].includes(name));

// Get color class based on category
const colorMap: Record<string, string> = {
  'chat': 'from-blue-400 to-blue-600',
  'image': 'from-purple-400 to-purple-600', 
  'video': 'from-pink-400 to-pink-600',
  'code': 'from-emerald-400 to-emerald-600',
  'writing': 'from-amber-400 to-amber-600',
  'audio': 'from-rose-400 to-rose-600',
  'office': 'from-cyan-400 to-cyan-600',
  'design': 'from-violet-400 to-violet-600',
  'search': 'from-teal-400 to-teal-600',
  'model': 'from-indigo-400 to-indigo-600'
};

const iconColor = colorMap[color] || 'from-blue-400 to-blue-600';
const faIcon = colorMap[color] || 'robot';
---
<div class="tool-card bg-white rounded-xl border border-slate-200 p-4 hover:shadow-lg transition group relative"
     data-name={name}
     data-description={desc}
     data-category={category}
     data-tags={tags.join(',').toLowerCase()}
     data-pricing={pricing}
     data-rating={rating}
     data-url={effectiveUrl}>
    <div class="flex justify-between items-start mb-3">
        <!-- 点击图标打开详情弹窗 -->
        <div class="cursor-pointer flex-1" onclick={`window.openToolDetail('${name}', '${desc}', '${effectiveUrl}')`}>
            {logo ? (
                <img src={logo} alt={name} class="w-12 h-12 rounded-lg object-cover" onerror="this.parentElement.innerHTML='<div class=\'w-12 h-12 rounded-lg bg-gradient-to-br '+'from-blue-400 to-blue-600'+' flex items-center justify-center text-white\'><i class=\'fa-solid fa-robot text-2xl\'></i></div>';" />
            ) : (
                <div class={`w-12 h-12 rounded-lg bg-gradient-to-br ${iconColor} flex items-center justify-center text-white`}>
                    <i class={`fa-solid fa-${faIcon} text-2xl`}></i>
                </div>
            )}
        </div>
        
        <div class="flex items-center gap-2">
            <!-- 对比复选框 -->
            <label class="w-6 h-6 border-2 border-slate-300 rounded flex items-center justify-center cursor-pointer hover:border-blue-500 transition bg-white" title="添加到对比">
                <input type="checkbox" class="peer hidden compare-checkbox" data-tool-name={name}>
                <div class="w-3 h-3 bg-blue-500 rounded-sm scale-0 peer-checked:scale-100 transition-transform"></div>
            </label>
            
            <!-- 收藏按钮 -->
            <button class="w-6 h-6 flex items-center justify-center text-slate-400 hover:text-red-500 transition" id={favoriteId}>
                <i class="fa-regular fa-heart"></i>
            </button>
        </div>
    </div>
    
        <!-- 点击标题打开详情弹窗 -->
        <div class="cursor-pointer flex-1" onclick={`window.openToolDetail('${name}', '${desc}', '${effectiveUrl}')`}>
        <h3 class="font-bold text-slate-900 mb-1 group-hover:text-blue-600 transition">{name}</h3>
        <p class="text-xs text-slate-500 line-clamp-2 h-8">{desc}</p>
    </div>
    
    <div class="mt-3 flex flex-wrap gap-1.5">
        {tags.slice(0, 3).map((tag) => (
            <span class="px-2 py-0.5 bg-slate-100 text-slate-600 text-xs rounded-full">{tag}</span>
        ))}
    </div>
    
    <div class="mt-3 flex justify-between items-center border-t border-slate-50 pt-3">
        <div class="flex items-center">
            <div class="flex items-center text-amber-400 text-xs">
                {Array(5).fill(0).map((_, i) => (
                    <i class={`fa-solid fa-star ${i < Math.floor(rating) ? '' : 'fa-star-half-stroke'}`}></i>
                ))}
            </div>
            <span class="ml-1 text-xs text-slate-500">{rating}</span>
        </div>
        <a href={effectiveUrl} target="_blank" class="text-xs bg-blue-50 text-blue-600 px-3 py-1.5 rounded-full hover:bg-blue-100 transition font-medium">
            直达 <i class="fa-solid fa-arrow-right ml-1"></i>
        </a>
    </div>
</div>
